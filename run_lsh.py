from lshash import LSHash
from im2hist import connect
import time

db = connect()
res = []


lsh = LSHash(64, 15, 16, 0.7)

col = db.images2
for im in col.find()[:40000]:
    lsh.index(im['hists'], im['im_url'])
#lsh.upload(db)

start = time.time()
#res = lsh.query([11.164474487304688, 0.05191167195638021, 0.0, 0.0, 2.5472323099772134, 1.4715194702148438,
# 0.00022252400716145834, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.119781494140625, 0.0010808308919270833, 0.0, 0.0, 1.7841021219889324, 16.666793823242188, 0.32784144083658856, 0.0, 0.0, 1.2158711751302083, 1.6774177551269531, 0.0007947285970052084, 0.0, 0.0, 0.0, 0.000031789143880208336, 0.0, 0.0, 0.0, 0.0, 0.0, 0.101470947265625, 0.00006357828776041667, 0.0, 0.0, 36.63552602132162, 20.49719492594401, 0.010585784912109375, 0.0, 0.0, 0.9306589762369791, 1.5670458475748699, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.021870930989583332, 0.0, 0.0, 0.0, 0.055631001790364586, 3.1508763631184897], 10)
res = lsh.query([ 8.430374208301183, 11.93651740933642, 1.0203922726980452, 0.0, 0.30176610122492287,
                  11.751559536152905, 4.0085780767746915, 0.033362117814429014, 0.0, 0.0, 0.0021224159272119343,
                  0.03829139740869342, 0.0, 0.0, 0.0, 4.3955359439300415E-5, 0.6008948808834876, 0.2322098845807613,
                  0.035415461033950615, 2.1977679719650207E-4, 0.9118664902424125, 29.80328469610018,
                  2.8595347463348766, 0.006838198061342593, 0.07969106666345165, 1.2269133893550668,
                  1.1520950882523149, 0.053116912213863166, 0.0, 0.0, 0.0, 0.00273779095936214, 0.0, 0.0, 0.0, 0.0, 0.0017707730516975308, 0.07867381405928497, 0.04077801488554527, 0.002838260352366255, 0.0074849697788065845, 1.6137707871174125, 8.840502829218106, 0.8717101297260802, 0.0, 0.0010800459747942388, 0.19690745161394033, 0.6277076501414609, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0674873006687242E-4, 0.002398706757973251, 0.43380800098058125, 0.05282806270897634, 3.139668531378601E-5, 4.646709426440329E-4, 1.0131961524241255, 11.726115662374614 ], 10)
end = time.time()
print(end-start)

for r in res:
    print(r[0][1], r[1])

'''
lsh = LSHash(6, 8, 5)
lsh.index([1,2,3,4,5,6,7,8])
lsh.index([2,3,4,5,6,7,8,9])
lsh.index([10,12,99,1,5,31,2,3])
lsh.index([10,11,99,1,5,31,2,3])
res = lsh.query([1,2,3,4,5,6,7,7], 3)
'''