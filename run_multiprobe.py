from multiprobe_lsh import MultiprobeLSH
from im2hist import connect
import time

db = connect()
col = db.images2

mp = MultiprobeLSH(dim=64, l=15, m=16, w=40, t=1000)
#for pv in mp.perturb_vecs:
#    print(pv)

for im in col.find().limit(200):
    mp.insert(im['hists'], im['im_url'])


start = time.time()
res = mp.query([11.164474487304688, 0.05191167195638021, 0.0, 0.0, 2.5472323099772134, 1.4715194702148438, 0.00022252400716145834, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.119781494140625, 0.0010808308919270833, 0.0, 0.0, 1.7841021219889324, 16.666793823242188, 0.32784144083658856, 0.0, 0.0, 1.2158711751302083, 1.6774177551269531, 0.0007947285970052084, 0.0, 0.0, 0.0, 0.000031789143880208336, 0.0, 0.0, 0.0, 0.0, 0.0, 0.101470947265625, 0.00006357828776041667, 0.0, 0.0, 36.63552602132162, 20.49719492594401, 0.010585784912109375, 0.0, 0.0, 0.9306589762369791, 1.5670458475748699, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.021870930989583332, 0.0, 0.0, 0.0, 0.055631001790364586, 3.1508763631184897], 10)

end = time.time()
print(end - start)

for r in res:
    print(r)